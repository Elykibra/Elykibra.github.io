<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kyle Tolilic - Automation Engineer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0f1a;
            color: #E5E7EB;
            overflow: hidden;
        }
        .canvas-grid {
            background-image: radial-gradient(#2d3748 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .node-card {
            background: rgba(31, 41, 55, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid #374151;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.3s, box-shadow 0.3s;
        }
        .node-card.processing {
            border-color: #FBBF24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.2);
            transform: translateY(-4px) scale(1.02);
        }
        .node-card.failed {
            border-color: #EF4444;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.2);
        }
        .line-flow {
            stroke-dasharray: 8;
            animation: flow 30s linear infinite;
        }
        @keyframes flow {
            from { stroke-dashoffset: 500; }
            to { stroke-dashoffset: 0; }
        }
        .data-packet {
            fill: #FBBF24;
            filter: drop-shadow(0 0 8px #FBBF24);
            transition: fill 0.3s;
        }
        .data-packet.error-packet {
            fill: #EF4444;
            filter: drop-shadow(0 0 8px #EF4444);
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .console-scrollbar::-webkit-scrollbar { width: 4px; }
        .console-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        
        #terminal-input:focus { outline: none; }

        .toggle-btn.active {
            background-color: #FBBF24;
            color: #0b0f1a;
            font-weight: 800;
        }

        .exec-card, .landing-card {
            background: linear-gradient(145deg, rgba(31, 41, 55, 0.4), rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .landing-card:hover {
            border-color: #FBBF24;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }
        
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100%;
                width: 85%;
                transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 20px 0 50px rgba(0,0,0,0.5);
                z-index: 100;
            }
            #sidebar.open { left: 0; }
            #sidebar-overlay.visible { opacity: 1; pointer-events: auto; }
            #sidebar-overlay.hidden-overlay { opacity: 0; pointer-events: none; }
        }

        #view-architect { 
            overscroll-behavior: contain;
            cursor: grab;
            user-select: none;
        }
        #view-architect:active {
            cursor: grabbing;
        }

        .hero-gradient {
            background: radial-gradient(circle at top center, rgba(251, 191, 36, 0.05), transparent 70%);
        }

        .glow-pulse {
            position: absolute;
            inset: -2px;
            border-radius: 0.75rem;
            background: linear-gradient(45deg, #FBBF24, transparent, #FBBF24);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }
        .processing .glow-pulse {
            opacity: 0.4;
            animation: rotateGlow 2s linear infinite;
        }
        @keyframes rotateGlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased h-screen flex flex-col md:flex-row">

    <div id="sidebar-overlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden-overlay md:hidden z-40"></div>

    <aside id="sidebar" class="w-full md:w-80 bg-gray-900 border-r border-gray-800 p-6 flex flex-col h-full z-50">
        <div class="mb-8 flex items-center justify-between">
            <div onclick="setViewMode('landing')" class="cursor-pointer group">
                <h1 class="text-2xl font-black text-white tracking-tight uppercase group-hover:text-amber-500 transition-colors">Kyle Tolilic</h1>
                <p class="text-amber-500 font-bold text-xs mt-1 uppercase tracking-widest">Automation Engineer</p>
            </div>
            <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-400 hover:text-white transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <nav class="space-y-6 flex-grow overflow-y-auto pr-2 console-scrollbar">
            <div>
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Intelligence Systems</h3>
                <div class="space-y-2">
                    <button onclick="loadScenario('mother-ai')" id="btn-mother-ai" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Mother AI Orchestrator</span>
                        <i data-lucide="cpu" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div>
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Diagnostic Reports</h3>
                <div class="space-y-2">
                    <button onclick="loadScenario('zapier-debug')" id="btn-zapier-debug" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Failed Payment Debug</span>
                        <i data-lucide="bug" class="w-4 h-4"></i>
                    </button>
                    <button onclick="loadScenario('ai-validation')" id="btn-ai-validation" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>AI Validation Flow</span>
                        <i data-lucide="shield-check" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div>
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Production Pipelines</h3>
                <div class="space-y-2">
                    <button onclick="loadScenario('attorney')" id="btn-attorney" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Attorney Pipeline v2.0</span>
                        <i data-lucide="briefcase" class="w-4 h-4"></i>
                    </button>
                    <button onclick="loadScenario('helpscout')" id="btn-helpscout" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Help Scout Sage</span>
                        <i data-lucide="message-square" class="w-4 h-4"></i>
                    </button>
                    <button onclick="loadScenario('aethelgard')" id="btn-aethelgard" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Aethelgard RPG</span>
                        <i data-lucide="swords" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div class="pt-6 border-t border-gray-800 space-y-4">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-1 text-amber-500/50">Connectivity</h3>
                
                <!-- Updated CV Link to use the file you uploaded to GitHub -->
                <a href="Kyle_Tolilic_Resume.pdf" download="Kyle_Tolilic_Resume.pdf" class="flex items-center justify-between w-full px-4 py-3 bg-amber-500/10 border border-amber-500/20 rounded-xl text-amber-500 text-[10px] font-black uppercase tracking-widest hover:bg-amber-500 hover:text-gray-900 transition-all group mb-2">
                    <span class="flex items-center gap-2">
                        <i data-lucide="file-text" class="w-4 h-4"></i>
                        Download CV
                    </span>
                    <i data-lucide="download" class="w-3 h-3 opacity-50 group-hover:opacity-100"></i>
                </a>

                <a href="mailto:ktolilic@gmail.com" class="flex items-center space-x-3 text-sm text-gray-400 hover:text-amber-500 transition-colors">
                    <i data-lucide="mail" class="w-4 h-4"></i>
                    <span>ktolilic@gmail.com</span>
                </a>
                <a href="tel:+639457392267" class="flex items-center space-x-3 text-sm text-gray-400 hover:text-amber-500 transition-colors">
                    <i data-lucide="phone" class="w-4 h-4"></i>
                    <span>+63 945 739 2267</span>
                </a>
                <div class="flex items-center space-x-4 pt-2">
                    <a href="https://github.com/Elykibra" target="_blank" class="text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="github" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/kyle-tolilic" target="_blank" class="text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="linkedin" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.behance.net/kyle_tolilic" target="_blank" class="text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="palette" class="w-5 h-5"></i>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <main class="flex-grow relative overflow-hidden flex flex-col bg-[#0b0f1a]">
        
        <header id="main-header" class="hidden p-3 md:p-4 bg-gray-900/80 backdrop-blur-md border-b border-gray-800 flex flex-col md:flex-row gap-4 justify-between items-center z-20">
            <div class="flex items-center w-full md:w-auto justify-between md:justify-start gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="toggleMobileMenu()" class="md:hidden p-2 -ml-2 text-gray-400 hover:text-amber-500 transition-all">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <h2 id="scenario-title" class="text-xs md:text-sm font-bold text-white uppercase tracking-wider truncate max-w-[140px] md:max-w-none">Scenario Name</h2>
                </div>
                
                <div class="h-6 w-px bg-gray-800 hidden md:block"></div>
                
                <div class="flex p-1 bg-black/40 rounded-lg border border-white/5 flex-shrink-0">
                    <button onclick="setViewMode('architect')" id="mode-architect" class="toggle-btn active px-3 md:px-5 py-2 rounded text-[9px] md:text-[10px] uppercase tracking-widest transition-all">Architect View</button>
                    <button onclick="setViewMode('executive')" id="mode-executive" class="toggle-btn px-3 md:px-5 py-2 rounded text-[9px] md:text-[10px] uppercase tracking-widest transition-all text-gray-500">Executive Summary</button>
                </div>
            </div>

            <div class="flex items-center gap-2 w-full md:w-auto justify-end">
                <button onclick="toggleTerminal()" id="term-btn" class="flex items-center gap-2 px-3 py-1.5 bg-gray-800 border border-gray-700 rounded-full text-gray-400 text-[9px] md:text-[10px] font-black uppercase tracking-widest hover:border-amber-500/50 hover:text-white transition-all">
                    <i data-lucide="terminal" class="w-3 h-3"></i>
                    <span>Console</span>
                </button>
                <div class="h-4 w-px bg-gray-800"></div>
                <button onclick="startSimulation()" id="sim-btn" class="flex items-center gap-2 px-4 py-1.5 bg-amber-500/10 border border-amber-500/50 rounded-full text-amber-500 text-[9px] md:text-[10px] font-black uppercase tracking-widest hover:bg-amber-500 hover:text-gray-900 transition-all">
                    <i data-lucide="play" class="w-3 h-3"></i>
                    <span>Trace Logic</span>
                </button>
            </div>
        </header>

        <!-- Landing View -->
        <div id="view-landing" class="flex-grow overflow-y-auto hero-gradient flex flex-col items-center justify-center p-6 md:p-12 console-scrollbar">
            <div class="max-w-5xl w-full space-y-16 animate-in fade-in slide-in-from-bottom-4 duration-1000">
                
                <div class="text-center space-y-8">
                    <div class="flex flex-col items-center gap-4">
                        <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-amber-500/10 border border-amber-500/20 rounded-full text-amber-500 text-[10px] font-black uppercase tracking-[0.2em]">
                            <i data-lucide="shield-check" class="w-3 h-3 animate-pulse"></i>
                            <span>Operational Excellence Initiated</span>
                        </div>
                        <div class="mono text-[10px] text-gray-600 bg-black/40 px-3 py-1 rounded-md border border-white/5">
                            system_init: <span class="text-amber-500/70">v2.5_stable</span> | root_auth: <span class="text-green-500/70">verified</span>
                        </div>
                    </div>

                    <h1 class="text-4xl md:text-8xl font-black text-white tracking-tighter uppercase leading-none">
                        Architecting <span class="text-amber-500">Deterministic</span><br>Flows.
                    </h1>
                    
                    <p class="text-gray-400 md:text-xl max-w-2xl mx-auto leading-relaxed font-medium">
                        Bridging the gap between manual operations and engineering excellence. I build high-fidelity, API-driven systems that manage high-stakes data and AI contexts with industrial reliability.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="landing-card p-8 rounded-3xl space-y-4 border-l-4 border-l-amber-500/20">
                        <i data-lucide="workflow" class="w-8 h-8 text-amber-500 mb-2"></i>
                        <h3 class="text-lg font-bold text-white uppercase tracking-tight">Workflow Engineering</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Designing resilient pipelines with advanced error handling, retries, and rate-limiting to ensure 99.9% process uptime.</p>
                    </div>
                    <div class="landing-card p-8 rounded-3xl space-y-4 border-l-4 border-l-amber-500/20">
                        <i data-lucide="binary" class="w-8 h-8 text-amber-500 mb-2"></i>
                        <h3 class="text-lg font-bold text-white uppercase tracking-tight">Data Hygiene Ops</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Implementing multi-layer deduplication and schema-first architectures to maintain absolute CRM and database integrity.</p>
                    </div>
                    <div class="landing-card p-8 rounded-3xl space-y-4 border-l-4 border-l-amber-500/20">
                        <i data-lucide="brain-circuit" class="w-8 h-8 text-amber-500 mb-2"></i>
                        <h3 class="text-lg font-bold text-white uppercase tracking-tight">Cognitive Orchestration</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Managing recursive LLM memory and semantic classifiers to automate complex decision-making with context persistence.</p>
                    </div>
                </div>

                <div class="space-y-6">
                    <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-[0.3em] text-center">Active Logic Traces</h4>
                    <div class="flex flex-wrap justify-center gap-4">
                        <button onclick="loadScenario('mother-ai')" class="px-6 py-3 bg-gray-900 border border-white/5 rounded-2xl text-xs font-bold text-gray-300 hover:border-amber-500 hover:text-white transition-all flex items-center gap-3 group">
                            <i data-lucide="cpu" class="w-4 h-4 text-gray-500 group-hover:text-amber-500"></i>
                            Mother AI Core
                        </button>
                        <button onclick="loadScenario('attorney')" class="px-6 py-3 bg-gray-900 border border-white/5 rounded-2xl text-xs font-bold text-gray-300 hover:border-amber-500 hover:text-white transition-all flex items-center gap-3 group">
                            <i data-lucide="briefcase" class="w-4 h-4 text-gray-500 group-hover:text-amber-500"></i>
                            Attorney Pipeline
                        </button>
                        <button onclick="loadScenario('helpscout')" class="px-6 py-3 bg-gray-900 border border-white/5 rounded-2xl text-xs font-bold text-gray-300 hover:border-amber-500 hover:text-white transition-all flex items-center gap-3 group">
                            <i data-lucide="message-square" class="w-4 h-4 text-gray-500 group-hover:text-amber-500"></i>
                            Help Scout Sage
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-architect" class="hidden flex-grow canvas-grid relative overflow-auto">
            <div class="relative w-[1800px] md:w-[2400px] h-[1000px] md:h-[1200px] pointer-events-none">
                <svg id="svg-layer" class="absolute top-0 left-0 w-full h-full pointer-events-none z-0"></svg>
                <div id="node-layer" class="absolute top-0 left-0 w-full h-full z-10 pointer-events-auto"></div>
            </div>
            
            <div id="live-terminal" class="fixed md:absolute bottom-6 left-4 right-4 md:left-6 md:right-6 h-48 md:h-56 bg-black/95 backdrop-blur-xl border border-white/10 rounded-xl z-30 overflow-hidden flex flex-col transition-all duration-300 shadow-2xl opacity-0 pointer-events-none translate-y-10">
                <div class="flex items-center justify-between px-4 py-2 bg-white/5 border-b border-white/5">
                    <span class="text-[9px] font-black uppercase tracking-widest text-gray-500">System Trace Log</span>
                    <button onclick="toggleTerminal(false)" class="text-gray-500 hover:text-white">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
                <div id="log-container" class="p-4 text-[10px] mono text-gray-400 space-y-1 overflow-y-auto flex-grow console-scrollbar"></div>
                <div class="p-3 bg-black/40 border-t border-white/5 flex items-center space-x-2">
                    <span class="text-amber-500 text-xs mono font-bold ml-1">></span>
                    <input type="text" id="terminal-input" placeholder="Inject data (e.g. 'fail')..." class="bg-transparent border-none text-amber-500 text-xs mono w-full focus:ring-0 placeholder:text-gray-700" autocomplete="off">
                </div>
            </div>
        </div>

        <div id="view-executive" class="hidden flex-grow overflow-y-auto bg-[#0b0f1a] p-5 md:p-12 flex flex-col items-center console-scrollbar">
            <div class="max-w-4xl w-full space-y-8 md:space-y-12 pb-20">
                <div class="space-y-4 border-l-4 border-amber-500 pl-4 md:pl-8">
                    <h2 class="text-2xl md:text-4xl font-black text-white uppercase tracking-tighter leading-tight" id="exec-title">Title</h2>
                    <div class="flex flex-wrap items-center gap-2 md:gap-3">
                        <span class="px-3 py-1 bg-amber-500/10 text-amber-500 text-[9px] md:text-[10px] font-black uppercase tracking-widest rounded-full border border-amber-500/20" id="exec-intent">Intent</span>
                        <span class="text-gray-600 text-[9px] md:text-[10px] font-bold uppercase tracking-widest">Engineering Case Study</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8">
                    <div class="exec-card p-6 md:p-8 rounded-2xl md:rounded-3xl">
                        <div class="flex items-center space-x-3 mb-4 text-gray-400">
                            <i data-lucide="alert-circle" class="w-4 h-4"></i>
                            <h4 class="text-[10px] font-black uppercase tracking-widest">The Problem</h4>
                        </div>
                        <p id="exec-problem" class="text-xs md:text-sm text-gray-300 leading-relaxed font-medium"></p>
                    </div>
                    <div class="exec-card p-6 md:p-8 rounded-2xl md:rounded-3xl">
                        <div class="flex items-center space-x-3 mb-4 text-amber-500">
                            <i data-lucide="cpu" class="w-4 h-4"></i>
                            <h4 class="text-[10px] font-black uppercase tracking-widest">The Solution</h4>
                        </div>
                        <p id="exec-solution" class="text-xs md:text-sm text-gray-300 leading-relaxed font-medium"></p>
                    </div>
                    <div class="exec-card p-6 md:p-8 rounded-2xl md:rounded-3xl">
                        <div class="flex items-center space-x-3 mb-4 text-green-500">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                            <h4 class="text-[10px] font-black uppercase tracking-widest">The Outcome</h4>
                        </div>
                        <p id="exec-result" class="text-xs md:text-sm text-gray-300 leading-relaxed font-medium"></p>
                    </div>
                </div>

                <div class="bg-gray-900/50 border border-white/5 p-6 md:p-10 rounded-2xl md:rounded-[3rem] relative overflow-hidden">
                    <h4 class="text-[9px] md:text-[11px] font-black text-amber-500 uppercase mb-8 md:mb-10 tracking-[0.2em] text-center">System Performance Metrics</h4>
                    <div id="exec-kpis" class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-12 relative z-10"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                    <div class="space-y-6">
                        <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="shield-alert" class="w-3 h-3"></i> Engineering Constraints
                        </h4>
                        <div id="exec-restraint" class="bg-black/20 p-6 md:p-8 rounded-2xl md:rounded-3xl border border-white/5 text-xs md:text-sm text-gray-400 italic leading-relaxed"></div>
                    </div>
                    <div class="space-y-6">
                        <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="target" class="w-3 h-3"></i> Functional Impact
                        </h4>
                        <div id="exec-value" class="bg-amber-500/5 p-6 md:p-8 rounded-2xl md:rounded-3xl border border-amber-500/10 text-xs md:text-sm text-amber-100/70 leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="drawer" class="fixed top-0 right-0 h-full w-full md:w-[520px] bg-[#0f172a] border-l border-white/10 shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-[60] flex flex-col">
            <div class="p-5 md:p-6 border-b border-white/5 flex justify-between items-center bg-gray-900/50">
                <div class="flex items-center space-x-4">
                    <div id="drawer-icon" class="p-3 bg-amber-500/20 rounded-xl text-amber-500 border border-amber-500/20"></div>
                    <div>
                        <h3 id="drawer-name" class="text-lg md:text-xl font-bold text-white">Node Name</h3>
                        <p id="drawer-type" class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Step Type</p>
                    </div>
                </div>
                <button onclick="closeDrawer()" class="p-2 hover:bg-white/5 rounded-full text-gray-400 transition-all">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="p-6 md:p-8 space-y-8 overflow-y-auto flex-grow console-scrollbar">
                <section class="bg-amber-500/5 border border-amber-500/20 p-5 rounded-2xl">
                    <h4 class="text-[10px] font-bold text-amber-500 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i data-lucide="lightbulb" class="w-3 h-3"></i> Conceptual metaphor
                    </h4>
                    <p id="drawer-metaphor" class="text-sm text-amber-100/90 leading-relaxed italic"></p>
                </section>

                <section>
                    <h4 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i data-lucide="target" class="w-3 h-3"></i> Engineering Goal
                    </h4>
                    <p id="drawer-purpose" class="text-sm text-gray-300 leading-relaxed font-medium"></p>
                </section>

                <section>
                    <h4 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i data-lucide="terminal" class="w-3 h-3"></i> Logic Loop
                    </h4>
                    <div id="drawer-logic" class="bg-black/40 border border-white/5 rounded-xl p-5 text-xs text-gray-300 leading-relaxed mono whitespace-pre-wrap border-l-2 border-l-blue-500/50"></div>
                </section>

                <div class="bg-gray-900/50 p-5 rounded-2xl border border-white/5">
                    <h4 class="text-[10px] font-bold text-amber-500 uppercase mb-3">Toolchain</h4>
                    <div id="drawer-tools" class="flex flex-wrap gap-2"></div>
                </div>

                <section class="pb-10">
                    <h4 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Live execution</h4>
                    <div class="space-y-4">
                        <div class="bg-black/60 rounded-xl border border-blue-500/20 overflow-hidden">
                            <pre id="drawer-input" class="p-4 text-[10px] text-blue-300/80 overflow-x-auto mono"></pre>
                        </div>
                        <div class="bg-black/60 rounded-xl border border-purple-500/20 overflow-hidden">
                            <pre id="drawer-output" class="p-4 text-[10px] text-purple-300/80 overflow-x-auto mono"></pre>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <footer class="p-3 bg-gray-900 border-t border-gray-800 flex justify-center space-x-6 md:space-x-12 z-20 overflow-x-auto whitespace-nowrap scrollbar-hide">
            <div class="flex items-center space-x-2 text-[8px] font-black uppercase tracking-widest text-gray-600">
                <i data-lucide="database" class="w-3 h-3 text-amber-500/50"></i>
                <span>Truth vs Event</span>
            </div>
            <div class="flex items-center space-x-2 text-[8px] font-black uppercase tracking-widest text-gray-600">
                <i data-lucide="shield" class="w-3 h-3 text-amber-500/50"></i>
                <span>Deterministic Logic</span>
            </div>
            <div class="flex items-center space-x-2 text-[8px] font-black uppercase tracking-widest text-gray-600">
                <i data-lucide="award" class="w-3 h-3 text-amber-500/50"></i>
                <span>Java Certified</span>
            </div>
        </footer>
    </main>

    <script>
        const scenarioData = {
            'mother-ai': {
                title: "Mother AI Orchestrator",
                intent: "Recursive Cognitive Layer",
                summary: "A custom desktop IDE developed to enforce AI Context Persistence, solving context loss issues across long-running development sessions.",
                executive: {
                    problem: "Creative projects suffer from 'context drift' where technical vision is lost during multi-step build cycles.",
                    solution: "An IDE using dual-persistence (YAML/JSON) and recursive 'Echo' agents to synthesize event data into stable heuristics.",
                    result: "Achieved a 60% reduction in manual status tracking and preserved 90%+ context accuracy.",
                    value: "Transforms raw data into institutional knowledge; every lesson learned is automatically codified.",
                    kpis: [["Accuracy", "92%"], ["Overhead", "-60%"], ["Latency", "<2s"], ["State", "Prod"]],
                    restraint: "Automation is limited to metadata to preserve architectural integrity; manual confirmation required for code writes."
                },
                nodes: [
                    { id: 'm1', x: 100, y: 300, type: 'Input', name: 'Context Siphon', icon: 'eye', purpose: 'Detects high-value file changes via GitPython to minimize LLM token bloat.', logic: 'git_diff.stdout.splitlines()\nfilter(is_relevant_file)\nsummarize_changes(llm_minimal)', metaphor: 'A digital cartographer mapping only the changes in the terrain.', input: '{ "file": "app.py", "diff": "+20, -5" }', output: '{ "summary": "Fixed logic in Step 4" }', tools: ['GitPython', 'Python'] },
                    { id: 'm2', x: 400, y: 300, type: 'Core', name: 'Orchestrator Kernel', icon: 'cpu', purpose: 'The central frame-state manager of the Tkinter-based IDE.', logic: 'while(True):\n  event = await_intake()\n  if(event.type == "Code"):\n    dispatch(m4_echo_engine)\n  else:\n    update_ui_state(event)', metaphor: 'A librarian who remembers every book ever pulled off the shelf.', input: '{ "event": "code_save" }', output: '{ "state": "Updated" }', tools: ['Python', 'Tkinter'] },
                    { id: 'm3', x: 700, y: 300, type: 'Memory', name: 'State Persistence', icon: 'save', purpose: 'Enforce context persistence via dual-mode storage (JSON Config/YAML Logs).', logic: 'save_to_json("active_config.json")\nappend_to_yaml("history_log.yaml", timestamp=now)', metaphor: 'A black box flight recorder for developer thoughts.', input: '{ "reflection": "API key moved to env" }', output: '{ "write": "SUCCESS" }', tools: ['PyYAML', 'JSON'] },
                    { id: 'm4', x: 700, y: 100, type: 'Agent', name: 'Echo Engine', icon: 'message-circle', purpose: 'Synthesize meta-cognitive heuristics to adjust AI behavior over time.', logic: 'query_recent_history(limit=5)\ngenerate_heuristic_bridge()\nupdate_prompt_mask()', metaphor: 'An assistant who finishes your sentences because they know your habits.', input: '{ "task": "refactor" }', output: '{ "advice": "Use decorator pattern" }', tools: ['Gemini 1.5'] },
                    { id: 'm5', x: 1000, y: 100, type: 'Gateway', name: 'Zapier Gateway', icon: 'zap', purpose: 'External sync.', logic: 'if(milestone_reached):\n  payload = craft_webhook()\n  POST(zapier_hook_url, payload)', metaphor: 'The diplomat relaying status reports to the high command.', input: '{ "milestone": "Prod Deployment" }', output: '{ "status": "200 OK" }', tools: ['Zapier', 'Webhooks'] },
                    { id: 'm6', x: 1000, y: 300, type: 'Global', name: 'Heuristic Bank', icon: 'database', purpose: 'Stabilize cross-project insights into a permanent SQL knowledge base.', logic: 'INSERT INTO insights (project_id, logic_pattern, success_rate)\nON CONFLICT DO UPDATE', metaphor: 'The Master Encyclopedia of engineering lessons learned.', input: '{ "pattern": "Async retries" }', output: '{ "db_id": 492 }', tools: ['PostgreSQL'] }
                ],
                edges: [['m1', 'm2'], ['m2', 'm3'], ['m2', 'm4'], ['m4', 'm5'], ['m3', 'm6'], ['m5', 'm6']]
            },
            'zapier-debug': {
                title: "Failed Payment Debug",
                intent: "Financial Data Integrity",
                summary: "Fixes a critical 'Stale Data' bug in payment reminders by introducing runtime CRM lookups.",
                executive: {
                    problem: "Paid customers were receiving failure emails because automation relied on Stripe's stale initial triggers.",
                    solution: "Introduced a Step 11.5 forced CRM lookup to refresh source-of-truth before email dispatch.",
                    result: "100% elimination of erroneous emails. Restored brand trust.",
                    value: "Ensures communication always aligns with the live financial state.",
                    kpis: [["Error Rate", "0%"], ["Tickets", "-40%"], ["Precision", "100%"], ["Status", "Live"]],
                    restraint: "Fail-Closed: System halts if CRM API is unresponsive to prevent accidental sends."
                },
                nodes: [
                    { id: 'z1', x: 150, y: 300, type: 'Trigger', name: 'Initial Signal', icon: 'zap', purpose: 'Ingest untrusted failure signals from payment processors.', logic: 'on_webhook_receive("charge.failed")\nparse_charge_id()\nemit_process_start()', metaphor: 'Hearing a distant alarm that might be a false positive.', input: '{ "charge": "fail", "id": "ch_123" }', output: '{ "trusted": false }', tools: ['Stripe'] },
                    { id: 'z2', x: 450, y: 300, type: 'Buffer', name: 'Temporal Buffer', icon: 'clock', purpose: 'Introduce necessary friction to allow asynchronous retries to settle.', logic: 'sleep(3600 * 24)\nverify_current_time_window()', metaphor: 'Checking the caller ID before picking up the phone.', input: '{ "delay": "24h" }', output: '{ "ready": true }', tools: ['Zapier'] },
                    { id: 'z3', x: 750, y: 300, type: 'Lookup', name: 'Step 11.5 Truth Sync', icon: 'search', purpose: 'Enforce strict data integrity via live CRM query before taking action.', logic: 'query_crm(contact_id)\nif(deal_status == "Paid"):\n  abort_workflow()\nelse:\n  continue_to_comms()', metaphor: 'Calling the store manager to see if the check actually cleared.', input: '{ "query": "Status" }', output: '{ "truth": "Paid" }', tools: ['CRM API'] },
                    { id: 'z4', x: 1050, y: 300, type: 'Router', name: 'Airlock Gate', icon: 'filter', purpose: 'Automated logic branch to prevent miscommunication.', logic: 'if(payload.truth == "Paid"):\n  STOP()\nelse:\n  PASS()', metaphor: 'The security gate that only opens for people without a ticket.', input: '{ "truth": "Paid" }', output: 'TERMINATED', tools: ['Filter'] },
                    { id: 'z5', x: 1350, y: 300, type: 'Action', name: 'Safe Comms', icon: 'mail', purpose: 'Execute engagement with 100% state confidence.', logic: 'send_personalized_email()\nlog_outreach_in_crm()', metaphor: 'Delivering mail to an address that was double-checked today.', input: '{ "action": "Email" }', output: '{ "sent": true }', tools: ['Gmail API'] }
                ],
                edges: [['z1', 'z2'], ['z2', 'z3'], ['z3', 'z4'], ['z4', 'z5']]
            },
            'ai-validation': {
                title: "AI Validation Flow",
                intent: "Semantic Data Hygiene",
                summary: "A lead quality gate performing semantic validation to ensure only professional data enters the CRM.",
                executive: {
                    problem: "Unprotected webhooks resulting in 'Ghost Leads' that waste agent capacity.",
                    solution: "A semantic 'Air-Lock' gate performing an LLM professional focus check.",
                    result: "Zero spam records in CRM. 98% bot detection.",
                    value: "Guaranteed Data Integrity and high-intent focus for sales.",
                    kpis: [["Detection", "98%"], ["Hygiene", "100%"], ["Latency", "1.2s"], ["Status", "Live"]],
                    restraint: "Fallback: Leads diverted to isolation logs if AI is uncertain."
                },
                nodes: [
                    { id: 'v1', x: 100, y: 300, type: 'Trigger', name: 'Raw Ingestion', icon: 'zap', purpose: 'Centralize untrusted input from public-facing webhooks.', logic: 'catch_hook()\nvalidate_json_schema()\nemit_raw_payload()', metaphor: 'The sorting room at a post office.', input: '{ "name": "...", "note": "junk" }', output: '{ "schema": "Valid" }', tools: ['Make'] },
                    { id: 'v2', x: 400, y: 300, type: 'AI Agent', name: 'Semantic Filter', icon: 'shield-check', purpose: 'Apply qualitative data analysis to determine lead professionality.', logic: 'analyze_text_intent(payload.note)\nscore_on_scale(1, 10)\nif(score < 7): mark_junk()', metaphor: 'An expert reading every letter to see if it’s real business or junk mail.', input: '{ "text": "Pls help" }', output: '{ "intent": "Spam", "score": 2 }', tools: ['Gemini'] },
                    { id: 'v3', x: 700, y: 300, type: 'Router', name: 'Aesthetic Router', icon: 'git-branch', purpose: 'Branch execution paths based on semantic scoring.', logic: 'if(score >= 7): path_success()\nelse: path_isolation()', metaphor: 'A train conductor switching tracks based on the cargo.', input: '{ "score": 2 }', output: 'Branch: Isolation', tools: ['Logic'] },
                    { id: 'v4', x: 1000, y: 100, type: 'Action', name: 'High-Fidelity Write', icon: 'database', purpose: 'Ingest verified data into the system of record.', logic: 'map_to_fields()\nPOST_to_CRM()\nverify_write_success()', metaphor: 'Placing a certified file into the vault.', input: '{ "verified": true }', output: '{ "record_id": 991 }', tools: ['Salesforce'] },
                    { id: 'v5', x: 1250, y: 100, type: 'Action', name: 'Success Alert', icon: 'slack', purpose: 'Notify human operators of high-intent arrivals.', logic: 'format_slack_message()\npush_notification()', metaphor: 'Ringing the victory bell in the office.', input: '{ "id": 991 }', output: '{ "alert": "Sent" }', tools: ['Slack'] },
                    { id: 'v6', x: 1000, y: 450, type: 'Action', name: 'Isolation Log', icon: 'alert-triangle', purpose: 'Preserve junk data for periodic audit without polluting the CRM.', logic: 'INSERT INTO audit_logs (payload, reason)\nmark_processed()', metaphor: 'The lost and found box for suspicious items.', input: '{ "reason": "Low Score" }', output: '{ "logged": true }', tools: ['PostgreSQL'] }
                ],
                edges: [['v1', 'v2'], ['v2', 'v3'], ['v3', 'v4'], ['v4', 'v5'], ['v3', 'v6']]
            },
            'attorney': {
                title: "Attorney Pipeline v2.0",
                intent: "Acquisition at Scale",
                summary: "A 28-step automation system to source, qualify, and generate personalized outreach for attorneys.",
                executive: {
                    problem: "Indiscriminate scraping lead to high API costs and low CRM hygiene.",
                    solution: "Staged data through GSheets for 5-layer Python deduplication and focus-grading.",
                    result: "96% lead accuracy and 50% cost reduction in scraping.",
                    value: "Scalable batch processing that only ingests high-intent leads.",
                    kpis: [["Accuracy", "96%"], ["Cost", "-50%"], ["Dedupe", "5-Layer"], ["Batch", "25"]],
                    restraint: "Manual Gate: Triggering is manual to ensure budget alignment."
                },
                nodes: [
                    { id: 'at1', x: 100, y: 300, type: 'Trigger', name: 'Control Gate', icon: 'zap', purpose: 'Enforce budget control through manual initiation.', logic: 'if(operator_authenticated):\n  trigger_pipeline()\n  log_start_event()', metaphor: 'Opening the main valve when the pressure is right.', input: 'START_CMD', output: 'INITIATED', tools: ['Notion'] },
                    { id: 'at2', x: 400, y: 300, type: 'Scraper', name: 'Relevance Scout', icon: 'search', purpose: 'Acquire high-probability targets based on territory params.', logic: 'query_scrapers(geo="US", niche="Immigration")\nfilter_missing_data()\nemit_raw_list()', metaphor: 'Scouting for specific landmarks in a new city.', input: '{ "niche": "Immigration" }', output: '[{ "firm": "..." }]', tools: ['Relevance AI'] },
                    { id: 'at3', x: 700, y: 300, type: 'Buffer', name: 'Staging Area', icon: 'layers', purpose: 'Batch ingestion to prevent CRM rate-limiting.', logic: 'write_batch(list, size=25)\nset_ready_flag()', metaphor: 'The staging area for trucks before they enter the warehouse.', input: '25 records', output: 'Staged', tools: ['GSheets'] },
                    { id: 'at4', x: 1000, y: 300, type: 'Logic', name: '5-Layer Dedupe', icon: 'filter', purpose: 'Maintain absolute database hygiene via exhaustive uniqueness checks.', logic: 'check(Email, Domain, Phone, FirmName, LinkedIn)\nif(match_found): purge_record()\nelse: pass_to_enrichment()', metaphor: 'A specialized security guard checking five different IDs.', input: 'Staged record', output: 'Unique record', tools: ['Python'] },
                    { id: 'at5', x: 1300, y: 300, type: 'AI Agent', name: 'Focus Classifier', icon: 'shield-check', purpose: 'Automated lead qualification through semantic profiling.', logic: 'classify_focus(website_text)\nif("Immigration" in focus): score=HIGH\nelse: score=LOW', metaphor: 'A specialist sorting mail by urgency and importance.', input: '{ "web": "immigration.com" }', output: '{ "focus": "HIGH" }', tools: ['Gemini'] },
                    { id: 'at6', x: 1600, y: 300, type: 'Action', name: 'Persona Drafter', icon: 'pen-tool', purpose: 'Scaling personalization without losing the human touch.', logic: 'draft_personalized_outreach(focus, firm_name)\nsave_to_drafts()', metaphor: 'A ghostwriter drafting a custom reply for your approval.', input: '{ "focus": "HIGH" }', output: 'DRAFT_SUCCESS', tools: ['OpenAI'] }
                ],
                edges: [['at1', 'at2'], ['at2', 'at3'], ['at3', 'at4'], ['at4', 'at5'], ['at5', 'at6']]
            },
            'helpscout': {
                title: "Help Scout Sage",
                intent: "Efficiency Multiplier",
                summary: "Context-aware AI Co-pilot generating private internal drafts for agents using an Express service.",
                executive: {
                    problem: "Routine tickets consume 40% bandwidth, slowing resolutions.",
                    solution: "Developed an Express service using Help Scout API to inject drafts as internal notes.",
                    result: "60% reduction in response time and 80% cost reduction vs native tools.",
                    value: "Scaling support capacity via human-in-the-loop AI assistance.",
                    kpis: [["Costs", "-80%"], ["Adoption", "85%"], ["Drafting", "-60%"], ["Status", "Live"]],
                    restraint: "Draft-Only: AI acts strictly as ghostwriter for agent review."
                },
                nodes: [
                    { id: 'hs1', x: 100, y: 300, type: 'Trigger', name: 'Draft Request', icon: 'mouse-pointer-2', purpose: 'Capture intent from support agents via sidebar app.', logic: 'on_button_click()\nPOST(express_endpoint, thread_id)', metaphor: 'Raising your hand when you need an assistant’s help.', input: '{ "thread_id": 102 }', output: '{ "req": "ACCEPTED" }', tools: ['Node.js', 'Express'] },
                    { id: 'hs2', x: 400, y: 300, type: 'Fetch', name: 'History Assembler', icon: 'file-search', purpose: 'Reconstruct full conversational context for accurate drafting.', logic: 'GET(HS_API, thread_history)\nconcatenate_messages(limit=10)\nemit_context()', metaphor: 'A lawyer reading through the entire case history.', input: '{ "id": 102 }', output: '{ "history": "..." }', tools: ['HS API'] },
                    { id: 'hs3', x: 700, y: 300, type: 'Intelligence', name: 'Intent Analyzer', icon: 'brain-circuit', purpose: 'Identify core ticket issues to ensure prompt relevancy.', logic: 'detect_sentiment(history)\ndetect_issue_category()\nemit_profile()', metaphor: 'Reading between the lines to understand the customer’s mood.', input: '{ "history": "Refund pls" }', output: '{ "intent": "billing" }', tools: ['Gemini'] },
                    { id: 'hs4', x: 1000, y: 300, type: 'AI Agent', name: 'Draft Architect', icon: 'sparkles', purpose: 'Generate professional, empathetic drafts using internal guidelines.', logic: 'generate_draft(intent, brand_voice)\nvalidate_against_policy()', metaphor: 'A ghostwriter following your specific brand guidelines.', input: '{ "intent": "billing" }', output: '{ "draft": "Hello..." }', tools: ['Gemini'] },
                    { id: 'hs5', x: 1300, y: 300, type: 'Quality', name: 'Tone Normalizer', icon: 'check-check', purpose: 'Ensure drafting consistency across diverse agent styles.', logic: 'refine_tone(draft, target="Friendly")\nstrip_hallucinations()', metaphor: 'A professional proofreader giving the draft a final polish.', input: '{ "draft": "..." }', output: '{ "polished": "..." }', tools: ['OpenAI'] },
                    { id: 'hs6', x: 1600, y: 300, type: 'Action', name: 'Note Injection', icon: 'send', purpose: 'Seamlessly provide draft to agent without customer visibility.', logic: 'POST(HS_API, private_note=polished)\nemit_agent_notif()', metaphor: 'Sliding a helpful sticky note onto the agent’s desk.', input: '{ "note": "..." }', output: '{ "success": true }', tools: ['HS API'] }
                ],
                edges: [['hs1', 'hs2'], ['hs2', 'hs3'], ['hs3', 'hs4'], ['hs4', 'hs5'], ['hs5', 'hs6']]
            },
            'aethelgard': {
                title: "Aethelgard RPG",
                intent: "Full-Stack Persistence",
                summary: "A complex, text-based Discord RPG demonstrating modular management with 30+ source files.",
                executive: {
                    problem: "Complex state management leads to database bloat and slow retrieval.",
                    solution: "Modular Python architecture with custom SQLite schema for player data.",
                    result: "Zero data loss with sub-millisecond query performance.",
                    value: "Manages complex state transitions and high-concurrency data events.",
                    kpis: [["Source", "30+ Files"], ["DB", "SQLite"], ["Language", "Python"], ["State", "Legacy"]],
                    restraint: "Strict decoupling of logic from data persistence."
                },
                nodes: [
                    { id: 'ae1', x: 100, y: 300, type: 'Trigger', name: 'Command Lexer', icon: 'keyboard', purpose: 'Translate unstructured chat commands into actionable game state logic.', logic: 'regex_match(user_msg)\nif(match): dispatch_to_module()\nelse: reply_help()', metaphor: 'The referee interpreting a player’s spoken move.', input: '"!attack dragon"', output: '{ "cmd": "ATTACK", "tgt": "dragon" }', tools: ['Python'] },
                    { id: 'ae2', x: 400, y: 300, type: 'Core', name: 'Game Engine', icon: 'swords', purpose: 'The primary logic hub managing interactions across 30+ modular files.', logic: 'calculate_battle_math(p_stats, m_stats)\ndetermine_outcome()\nemit_update()', metaphor: 'The set of rules determining what happens after the dice are rolled.', input: '{ "cmd": "ATTACK" }', output: '{ "res": "Win", "xp": 50 }', tools: ['Python'] },
                    { id: 'ae3', x: 700, y: 300, type: 'DB', name: 'Persistence Hub', icon: 'database', purpose: 'Maintain durable state transitions for thousands of data events.', logic: 'conn.execute("UPDATE players SET xp = xp + ? WHERE id = ?", (xp, p_id))\nconn.commit()', metaphor: 'Writing the new results onto the character sheet in permanent ink.', input: '{ "xp": 50 }', output: '{ "db_commit": "OK" }', tools: ['SQLite'] },
                    { id: 'ae4', x: 1000, y: 300, type: 'Broadcast', name: 'UI Responder', icon: 'message-circle', purpose: 'Deliver real-time feedback to players in the Discord environment.', logic: 'format_discord_embed(results)\nsend_to_channel(channel_id)', metaphor: 'Announcing the result of the battle to the stadium crowd.', input: '{ "res": "Win" }', output: 'Discord Embed Sent', tools: ['discord.py'] }
                ],
                edges: [['ae1', 'ae2'], ['ae2', 'ae3'], ['ae3', 'ae4']]
            }
        };

        let currentActiveView = 'landing';
        let activeScenario = null;
        let isSimulating = false;
        let isTerminalActive = false;
        let isMobileMenuOpen = false;

        // Panning State
        const architectView = document.getElementById('view-architect');
        let isPanning = false;
        let panStart = { x: 0, y: 0, sL: 0, sT: 0 };

        function initPanning() {
            architectView.addEventListener('mousedown', (e) => {
                if (e.target.closest('.node-card') || e.target.closest('button') || e.target.closest('#live-terminal')) return;
                isPanning = true;
                panStart = { x: e.clientX, y: e.clientY, sL: architectView.scrollLeft, sT: architectView.scrollTop };
            });

            window.addEventListener('mousemove', (e) => {
                if (!isPanning) return;
                const dx = e.clientX - panStart.x;
                const dy = e.clientY - panStart.y;
                architectView.scrollLeft = panStart.sL - dx;
                architectView.scrollTop = panStart.sT - dy;
            });

            window.addEventListener('mouseup', () => { isPanning = false; });

            architectView.addEventListener('touchstart', (e) => {
                if (e.target.closest('.node-card') || e.target.closest('button')) return;
                const touch = e.touches[0];
                isPanning = true;
                panStart = { x: touch.clientX, y: touch.clientY, sL: architectView.scrollLeft, sT: architectView.scrollTop };
            }, { passive: true });

            architectView.addEventListener('touchmove', (e) => {
                if (!isPanning) return;
                const touch = e.touches[0];
                const dx = touch.clientX - panStart.x;
                const dy = touch.clientY - panStart.y;
                architectView.scrollLeft = panStart.sL - dx;
                architectView.scrollTop = panStart.sT - dy;
            }, { passive: true });

            architectView.addEventListener('touchend', () => { isPanning = false; });
        }

        function toggleMobileMenu() {
            isMobileMenuOpen = !isMobileMenuOpen;
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (isMobileMenuOpen) {
                sidebar.classList.add('open');
                overlay.classList.remove('hidden-overlay');
                overlay.classList.add('visible');
            } else {
                sidebar.classList.remove('open');
                overlay.classList.remove('visible');
                overlay.classList.add('hidden-overlay');
            }
        }

        function setViewMode(mode) {
            currentActiveView = mode;
            document.getElementById('view-landing').classList.add('hidden');
            document.getElementById('view-architect').classList.add('hidden');
            document.getElementById('view-executive').classList.add('hidden');
            document.getElementById('main-header').classList.remove('hidden');

            if (mode === 'landing') {
                document.getElementById('view-landing').classList.remove('hidden');
                document.getElementById('main-header').classList.add('hidden');
            } else if (mode === 'architect') {
                document.getElementById('view-architect').classList.remove('hidden');
                renderCanvas();
            } else if (mode === 'executive') {
                document.getElementById('view-executive').classList.remove('hidden');
                renderExecutiveView();
            }

            document.querySelectorAll('.toggle-btn').forEach(b => {
                b.classList.remove('active');
                b.classList.add('text-gray-500');
            });
            const activeBtn = document.getElementById(`mode-${mode}`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.classList.remove('text-gray-500');
            }
        }

        function renderExecutiveView() {
            const s = scenarioData[activeScenario];
            if (!s) return;
            document.getElementById('exec-title').innerText = s.title;
            document.getElementById('exec-intent').innerText = s.intent;
            document.getElementById('exec-problem').innerText = s.executive.problem;
            document.getElementById('exec-solution').innerText = s.executive.solution;
            document.getElementById('exec-result').innerText = s.executive.result;
            document.getElementById('exec-restraint').innerText = s.executive.restraint;
            document.getElementById('exec-value').innerText = s.executive.value;
            
            const kpiContainer = document.getElementById('exec-kpis');
            kpiContainer.innerHTML = s.executive.kpis.map(k => `
                <div class="text-center group">
                    <div class="text-[8px] md:text-[9px] font-black text-gray-600 uppercase mb-1 md:mb-2 tracking-[0.2em] transition-colors">${k[0]}</div>
                    <div class="text-lg md:text-3xl font-black text-white group-hover:text-amber-500 transition-colors">${k[1]}</div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function addLog(message, type = 'info') {
            const container = document.getElementById('log-container');
            if (!container) return;
            const log = document.createElement('div');
            const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            if (type === 'success') log.className = "text-green-400";
            else if (type === 'process') log.className = "text-amber-400 font-bold";
            else if (type === 'system') log.className = "text-blue-400";
            else if (type === 'error') log.className = "text-red-400 font-bold";
            log.innerHTML = `<span class="opacity-20 mr-2 tracking-tighter">${time}</span> ${message}`;
            container.appendChild(log);
            container.scrollTop = container.scrollHeight;
        }

        function toggleTerminal(force) {
            const terminal = document.getElementById('live-terminal');
            const btn = document.getElementById('term-btn');
            if (force !== undefined) isTerminalActive = force;
            else isTerminalActive = !isTerminalActive;

            if (isTerminalActive) {
                terminal.style.opacity = '1'; 
                terminal.classList.remove('pointer-events-none', 'translate-y-10');
                if (btn) btn.classList.add('bg-amber-500/10', 'border-amber-500/50', 'text-amber-500');
            } else {
                terminal.style.opacity = '0'; 
                terminal.classList.add('pointer-events-none', 'translate-y-10');
                if (btn) btn.classList.remove('bg-amber-500/10', 'border-amber-500/50', 'text-amber-500');
            }
        }

        function loadScenario(id) {
            if (isSimulating) stopSimulation();
            const data = scenarioData[id];
            if (!data) return;
            activeScenario = id;
            if (isMobileMenuOpen) toggleMobileMenu();
            
            document.getElementById('scenario-title').innerText = data.title;
            document.querySelectorAll('nav button').forEach(btn => {
                btn.className = "w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 text-sm font-medium flex items-center justify-between transition-all group";
            });
            const activeBtn = document.getElementById(`btn-${id}`);
            if(activeBtn) activeBtn.className = "w-full text-left px-4 py-3 rounded-lg bg-amber-500/10 border border-amber-500/50 text-amber-500 text-sm font-bold flex items-center justify-between group";
            
            if (currentActiveView === 'landing') {
                setViewMode('architect');
            } else {
                setViewMode(currentActiveView);
            }
            
            addLog(`CONTEXT SWITCH: ${data.title}`, 'system');
        }

        function renderCanvas() {
            const data = scenarioData[activeScenario];
            if (!data) return;
            const nodeLayer = document.getElementById('node-layer');
            const svgLayer = document.getElementById('svg-layer');
            nodeLayer.innerHTML = ''; svgLayer.innerHTML = '';
            
            data.edges.forEach((edge, idx) => {
                const source = data.nodes.find(n => n.id === edge[0]);
                const target = data.nodes.find(n => n.id === edge[1]);
                if (!source || !target) return;
                const x1 = source.x + 192, y1 = source.y + 70, x2 = target.x, y2 = target.y + 70;
                const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
                line.setAttribute("d", `M ${x1} ${y1} C ${x1 + (x2-x1)/2} ${y1}, ${x1 + (x2-x1)/2} ${y2}, ${x2} ${y2}`);
                line.setAttribute("id", `path-${activeScenario}-${idx}`);
                line.setAttribute("stroke", "#1f2937"); line.setAttribute("stroke-width", "2");
                line.setAttribute("fill", "none"); line.setAttribute("class", "line-flow");
                svgLayer.appendChild(line);
            });
            
            data.nodes.forEach(node => {
                const div = document.createElement('div');
                div.id = `node-${node.id}`;
                div.className = "absolute node-card w-48 p-4 rounded-xl cursor-pointer shadow-xl z-10 flex flex-col h-[140px]";
                div.style.left = `${node.x}px`; div.style.top = `${node.y}px`;
                div.onclick = () => openDrawer(node);
                div.innerHTML = `<div class="glow-pulse"></div><span class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-2">${node.type}</span><div class="flex items-center space-x-3 mb-4"><div class="p-2 bg-gray-800 rounded-lg"><i data-lucide="${node.icon}" class="w-5 h-5"></i></div><h4 class="text-xs font-bold text-white leading-tight">${node.name}</h4></div>`;
                nodeLayer.appendChild(div);
            });
            lucide.createIcons();
        }

        async function startSimulation() {
            if (isSimulating || !activeScenario) return;
            isSimulating = true;
            toggleTerminal(true);
            const data = scenarioData[activeScenario];
            const svgLayer = document.getElementById('svg-layer');
            const packet = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            packet.setAttribute("r", "5"); packet.setAttribute("class", "data-packet");
            svgLayer.appendChild(packet);

            for (let i = 0; i < data.edges.length; i++) {
                if (!isSimulating) break;
                const edge = data.edges[i];
                const sourceNode = data.nodes.find(n => n.id === edge[0]);
                const path = document.getElementById(`path-${activeScenario}-${i}`);
                if (sourceNode) {
                    const nodeEl = document.getElementById(`node-${sourceNode.id}`);
                    if (nodeEl) {
                        nodeEl.classList.add('processing');
                        openDrawer(sourceNode);
                        addLog(`[STEP] ${sourceNode.name}`, 'process');
                    }
                    await new Promise(r => setTimeout(r, 600));
                    if (nodeEl) nodeEl.classList.remove('processing');
                }
                if (path) {
                    const length = path.getTotalLength();
                    const start = performance.now();
                    await new Promise(resolve => {
                        function animate(time) {
                            if (!isSimulating) return resolve();
                            const p = Math.min((time - start) / 600, 1);
                            const pt = path.getPointAtLength(p * length);
                            packet.setAttribute("cx", pt.x); packet.setAttribute("cy", pt.y);
                            if (p < 1) requestAnimationFrame(animate); else resolve();
                        }
                        requestAnimationFrame(animate);
                    });
                }
            }
            stopSimulation();
        }

        function stopSimulation() {
            isSimulating = false;
            document.querySelectorAll('.data-packet').forEach(p => p.remove());
            document.querySelectorAll('.node-card').forEach(n => n.classList.remove('processing', 'failed'));
            addLog(`TRACE COMPLETE.`, 'system');
        }

        function openDrawer(node, customInput = null) {
            const drawerEl = document.getElementById('drawer');
            if (!drawerEl) return;
            document.getElementById('drawer-name').innerText = node.name;
            document.getElementById('drawer-type').innerText = node.type;
            document.getElementById('drawer-logic').innerText = node.logic;
            document.getElementById('drawer-metaphor').innerText = node.metaphor;
            document.getElementById('drawer-purpose').innerText = node.purpose || "Primary engineering objective.";
            document.getElementById('drawer-input').innerText = customInput || node.input || "N/A";
            document.getElementById('drawer-output').innerText = node.output || "N/A";
            document.getElementById('drawer-tools').innerHTML = (node.tools || []).map(t => `<span class="px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400 font-bold border border-white/5 uppercase">${t}</span>`).join('');
            document.getElementById('drawer-icon').innerHTML = `<i data-lucide="${node.icon}" class="w-8 h-8"></i>`;
            drawerEl.classList.remove('translate-x-full'); 
            lucide.createIcons();
        }

        function closeDrawer() { document.getElementById('drawer').classList.add('translate-x-full'); }
        
        window.onload = () => { 
            setViewMode('landing'); 
            lucide.createIcons();
            initPanning();
        };

        document.getElementById('terminal-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const val = this.value.trim();
                if (!val) return;
                addLog(`INPUT: "${val}"`, 'process');
                startSimulation();
                this.value = '';
            }
        });
    </script>
</body>
</html>
