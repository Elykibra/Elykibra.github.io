<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kyle Tolilic - Automation Engineer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0f1a;
            color: #E5E7EB;
            overflow: hidden;
        }
        .canvas-grid {
            background-image: radial-gradient(#2d3748 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .node-card {
            background: rgba(31, 41, 55, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid #374151;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .node-card.processing {
            border-color: #FBBF24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.2);
            transform: translateY(-4px) scale(1.02);
        }
        .node-card.failed {
            border-color: #EF4444;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.2);
        }
        .line-flow {
            stroke-dasharray: 8;
            animation: flow 30s linear infinite;
        }
        @keyframes flow {
            from { stroke-dashoffset: 500; }
            to { stroke-dashoffset: 0; }
        }
        .data-packet {
            fill: #FBBF24;
            filter: drop-shadow(0 0 8px #FBBF24);
            transition: fill 0.3s;
        }
        .data-packet.error-packet {
            fill: #EF4444;
            filter: drop-shadow(0 0 8px #EF4444);
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .console-scrollbar::-webkit-scrollbar { width: 4px; }
        .console-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        
        #terminal-input:focus { outline: none; }

        .toggle-btn.active {
            background-color: #FBBF24;
            color: #0b0f1a;
            font-weight: 800;
        }

        .exec-card, .landing-card {
            background: linear-gradient(145deg, rgba(31, 41, 55, 0.4), rgba(15, 23, 42, 0.6));
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .landing-card:hover {
            border-color: #FBBF24;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }
        
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100%;
                width: 85%;
                transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 20px 0 50px rgba(0,0,0,0.5);
                z-index: 100;
            }
            #sidebar.open { left: 0; }
            #sidebar-overlay.visible { opacity: 1; pointer-events: auto; }
            #sidebar-overlay.hidden-overlay { opacity: 0; pointer-events: none; }
        }

        #view-architect { overscroll-behavior: contain; }

        .hero-gradient {
            background: radial-gradient(circle at top center, rgba(251, 191, 36, 0.05), transparent 70%);
        }

        .glow-pulse {
            position: absolute;
            inset: -2px;
            border-radius: 0.75rem;
            background: linear-gradient(45deg, #FBBF24, transparent, #FBBF24);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }
        .processing .glow-pulse {
            opacity: 0.4;
            animation: rotateGlow 2s linear infinite;
        }
        @keyframes rotateGlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased h-screen flex flex-col md:flex-row">

    <div id="sidebar-overlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden-overlay md:hidden z-40"></div>

    <aside id="sidebar" class="w-full md:w-80 bg-gray-900 border-r border-gray-800 p-6 flex flex-col h-full z-50">
        <div class="mb-8 flex items-center justify-between">
            <div onclick="setViewMode('landing')" class="cursor-pointer group">
                <h1 class="text-2xl font-black text-white tracking-tight uppercase group-hover:text-amber-500 transition-colors">Kyle Tolilic</h1>
                <p class="text-amber-500 font-bold text-xs mt-1 uppercase tracking-widest">Automation Engineer</p>
            </div>
            <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-400 hover:text-white transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <nav class="space-y-6 flex-grow overflow-y-auto pr-2 console-scrollbar">
            <div>
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Intelligence Systems</h3>
                <div class="space-y-2">
                    <button onclick="loadScenario('mother-ai')" id="btn-mother-ai" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Mother AI Orchestrator</span>
                        <i data-lucide="cpu" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div>
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Diagnostic Reports</h3>
                <div class="space-y-2">
                    <button onclick="loadScenario('zapier-debug')" id="btn-zapier-debug" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Failed Payment Debug</span>
                        <i data-lucide="bug" class="w-4 h-4"></i>
                    </button>
                    <button onclick="loadScenario('ai-validation')" id="btn-ai-validation" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>AI Validation Flow</span>
                        <i data-lucide="shield-check" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div>
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Production Pipelines</h3>
                <div class="space-y-2">
                    <button onclick="loadScenario('attorney')" id="btn-attorney" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Attorney Pipeline v2.0</span>
                        <i data-lucide="briefcase" class="w-4 h-4"></i>
                    </button>
                    <button onclick="loadScenario('helpscout')" id="btn-helpscout" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Help Scout Sage</span>
                        <i data-lucide="message-square" class="w-4 h-4"></i>
                    </button>
                    <button onclick="loadScenario('aethelgard')" id="btn-aethelgard" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 border border-transparent text-gray-400 text-sm font-medium flex items-center justify-between transition-all group">
                        <span>Aethelgard RPG</span>
                        <i data-lucide="swords" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div class="pt-6 border-t border-gray-800 space-y-4">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-1 text-amber-500/50">Connectivity</h3>
                
                <!-- Updated Download CV Button with correct filename reference -->
                <a href="Kyle%20Tolilic%20Resume.pdf" download="Kyle_Tolilic_Resume.pdf" class="flex items-center justify-between w-full px-4 py-3 bg-amber-500/10 border border-amber-500/20 rounded-xl text-amber-500 text-[10px] font-black uppercase tracking-widest hover:bg-amber-500 hover:text-gray-900 transition-all group mb-2">
                    <span class="flex items-center gap-2">
                        <i data-lucide="file-text" class="w-4 h-4"></i>
                        Download CV
                    </span>
                    <i data-lucide="download" class="w-3 h-3 opacity-50 group-hover:opacity-100"></i>
                </a>

                <a href="mailto:ktolilic@gmail.com" class="flex items-center space-x-3 text-sm text-gray-400 hover:text-amber-500 transition-colors">
                    <i data-lucide="mail" class="w-4 h-4"></i>
                    <span>ktolilic@gmail.com</span>
                </a>
                <a href="tel:+639457392267" class="flex items-center space-x-3 text-sm text-gray-400 hover:text-amber-500 transition-colors">
                    <i data-lucide="phone" class="w-4 h-4"></i>
                    <span>+63 945 739 2267</span>
                </a>
                <div class="flex items-center space-x-4 pt-2">
                    <a href="https://github.com/Elykibra" target="_blank" class="text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="github" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/kyle-tolilic" target="_blank" class="text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="linkedin" class="w-5 h-5"></i>
                    </a>
                    <a href="https://www.behance.net/kyle_tolilic" target="_blank" class="text-gray-500 hover:text-white transition-colors">
                        <i data-lucide="palette" class="w-5 h-5"></i>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <main class="flex-grow relative overflow-hidden flex flex-col bg-[#0b0f1a]">
        
        <header id="main-header" class="hidden p-3 md:p-4 bg-gray-900/80 backdrop-blur-md border-b border-gray-800 flex flex-col md:flex-row gap-4 justify-between items-center z-20">
            <div class="flex items-center w-full md:w-auto justify-between md:justify-start gap-4">
                <div class="flex items-center gap-3">
                    <button onclick="toggleMobileMenu()" class="md:hidden p-2 -ml-2 text-gray-400 hover:text-amber-500 transition-all">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <h2 id="scenario-title" class="text-xs md:text-sm font-bold text-white uppercase tracking-wider truncate max-w-[140px] md:max-w-none">Scenario Name</h2>
                </div>
                
                <div class="h-6 w-px bg-gray-800 hidden md:block"></div>
                
                <div class="flex p-1 bg-black/40 rounded-lg border border-white/5 flex-shrink-0">
                    <button onclick="setViewMode('architect')" id="mode-architect" class="toggle-btn active px-3 md:px-5 py-2 rounded text-[9px] md:text-[10px] uppercase tracking-widest transition-all">Architect View</button>
                    <button onclick="setViewMode('executive')" id="mode-executive" class="toggle-btn px-3 md:px-5 py-2 rounded text-[9px] md:text-[10px] uppercase tracking-widest transition-all text-gray-500">Executive Summary</button>
                </div>
            </div>

            <div class="flex items-center gap-2 w-full md:w-auto justify-end">
                <button onclick="toggleTerminal()" id="term-btn" class="flex items-center gap-2 px-3 py-1.5 bg-gray-800 border border-gray-700 rounded-full text-gray-400 text-[9px] md:text-[10px] font-black uppercase tracking-widest hover:border-amber-500/50 hover:text-white transition-all">
                    <i data-lucide="terminal" class="w-3 h-3"></i>
                    <span>Console</span>
                </button>
                <div class="h-4 w-px bg-gray-800"></div>
                <button onclick="startSimulation()" id="sim-btn" class="flex items-center gap-2 px-4 py-1.5 bg-amber-500/10 border border-amber-500/50 rounded-full text-amber-500 text-[9px] md:text-[10px] font-black uppercase tracking-widest hover:bg-amber-500 hover:text-gray-900 transition-all">
                    <i data-lucide="play" class="w-3 h-3"></i>
                    <span>Trace Logic</span>
                </button>
            </div>
        </header>

        <!-- Landing View -->
        <div id="view-landing" class="flex-grow overflow-y-auto hero-gradient flex flex-col items-center justify-center p-6 md:p-12 console-scrollbar">
            <div class="max-w-5xl w-full space-y-16 animate-in fade-in slide-in-from-bottom-4 duration-1000">
                
                <div class="text-center space-y-8">
                    <div class="flex flex-col items-center gap-4">
                        <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-amber-500/10 border border-amber-500/20 rounded-full text-amber-500 text-[10px] font-black uppercase tracking-[0.2em]">
                            <i data-lucide="shield-check" class="w-3 h-3 animate-pulse"></i>
                            <span>Operational Excellence Initiated</span>
                        </div>
                        <div class="mono text-[10px] text-gray-600 bg-black/40 px-3 py-1 rounded-md border border-white/5">
                            system_init: <span class="text-amber-500/70">v2.5_stable</span> | root_auth: <span class="text-green-500/70">verified</span>
                        </div>
                    </div>

                    <h1 class="text-4xl md:text-8xl font-black text-white tracking-tighter uppercase leading-none">
                        Architecting <span class="text-amber-500">Deterministic</span><br>Flows.
                    </h1>
                    
                    <p class="text-gray-400 md:text-xl max-w-2xl mx-auto leading-relaxed font-medium">
                        Bridging the gap between manual operations and engineering excellence. I build high-fidelity, API-driven systems that manage high-stakes data and AI contexts with industrial reliability.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="landing-card p-8 rounded-3xl space-y-4 border-l-4 border-l-amber-500/20">
                        <i data-lucide="workflow" class="w-8 h-8 text-amber-500 mb-2"></i>
                        <h3 class="text-lg font-bold text-white uppercase tracking-tight">Workflow Engineering</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Designing resilient pipelines with advanced error handling, retries, and rate-limiting to ensure 99.9% process uptime.</p>
                    </div>
                    <div class="landing-card p-8 rounded-3xl space-y-4 border-l-4 border-l-amber-500/20">
                        <i data-lucide="binary" class="w-8 h-8 text-amber-500 mb-2"></i>
                        <h3 class="text-lg font-bold text-white uppercase tracking-tight">Data Hygiene Ops</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Implementing multi-layer deduplication and schema-first architectures to maintain absolute CRM and database integrity.</p>
                    </div>
                    <div class="landing-card p-8 rounded-3xl space-y-4 border-l-4 border-l-amber-500/20">
                        <i data-lucide="brain-circuit" class="w-8 h-8 text-amber-500 mb-2"></i>
                        <h3 class="text-lg font-bold text-white uppercase tracking-tight">Cognitive Orchestration</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Managing recursive LLM memory and semantic classifiers to automate complex decision-making with context persistence.</p>
                    </div>
                </div>

                <div class="space-y-6">
                    <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-[0.3em] text-center">Active Logic Traces</h4>
                    <div class="flex flex-wrap justify-center gap-4">
                        <button onclick="loadScenario('mother-ai')" class="px-6 py-3 bg-gray-900 border border-white/5 rounded-2xl text-xs font-bold text-gray-300 hover:border-amber-500 hover:text-white transition-all flex items-center gap-3 group">
                            <i data-lucide="cpu" class="w-4 h-4 text-gray-500 group-hover:text-amber-500"></i>
                            Mother AI Core
                        </button>
                        <button onclick="loadScenario('attorney')" class="px-6 py-3 bg-gray-900 border border-white/5 rounded-2xl text-xs font-bold text-gray-300 hover:border-amber-500 hover:text-white transition-all flex items-center gap-3 group">
                            <i data-lucide="briefcase" class="w-4 h-4 text-gray-500 group-hover:text-amber-500"></i>
                            Attorney Pipeline
                        </button>
                        <button onclick="loadScenario('helpscout')" class="px-6 py-3 bg-gray-900 border border-white/5 rounded-2xl text-xs font-bold text-gray-300 hover:border-amber-500 hover:text-white transition-all flex items-center gap-3 group">
                            <i data-lucide="message-square" class="w-4 h-4 text-gray-500 group-hover:text-amber-500"></i>
                            Help Scout Sage
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-architect" class="hidden flex-grow canvas-grid relative overflow-auto cursor-grab active:cursor-grabbing scroll-smooth">
            <div class="relative w-[1800px] md:w-[2400px] h-[1000px] md:h-[1200px]">
                <svg id="svg-layer" class="absolute top-0 left-0 w-full h-full pointer-events-none z-0"></svg>
                <div id="node-layer" class="absolute top-0 left-0 w-full h-full z-10"></div>
            </div>
            
            <div id="live-terminal" class="fixed md:absolute bottom-6 left-4 right-4 md:left-6 md:right-6 h-48 md:h-56 bg-black/95 backdrop-blur-xl border border-white/10 rounded-xl z-30 overflow-hidden flex flex-col transition-all duration-300 shadow-2xl opacity-0 pointer-events-none translate-y-10">
                <div class="flex items-center justify-between px-4 py-2 bg-white/5 border-b border-white/5">
                    <span class="text-[9px] font-black uppercase tracking-widest text-gray-500">System Trace Log</span>
                    <button onclick="toggleTerminal(false)" class="text-gray-500 hover:text-white">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
                <div id="log-container" class="p-4 text-[10px] mono text-gray-400 space-y-1 overflow-y-auto flex-grow console-scrollbar"></div>
                <div class="p-3 bg-black/40 border-t border-white/5 flex items-center space-x-2">
                    <span class="text-amber-500 text-xs mono font-bold ml-1">></span>
                    <input type="text" id="terminal-input" placeholder="Inject data (e.g. 'fail')..." class="bg-transparent border-none text-amber-500 text-xs mono w-full focus:ring-0 placeholder:text-gray-700" autocomplete="off">
                </div>
            </div>
        </div>

        <div id="view-executive" class="hidden flex-grow overflow-y-auto bg-[#0b0f1a] p-5 md:p-12 flex flex-col items-center console-scrollbar">
            <div class="max-w-4xl w-full space-y-8 md:space-y-12 pb-20">
                <div class="space-y-4 border-l-4 border-amber-500 pl-4 md:pl-8">
                    <h2 class="text-2xl md:text-4xl font-black text-white uppercase tracking-tighter leading-tight" id="exec-title">Title</h2>
                    <div class="flex flex-wrap items-center gap-2 md:gap-3">
                        <span class="px-3 py-1 bg-amber-500/10 text-amber-500 text-[9px] md:text-[10px] font-black uppercase tracking-widest rounded-full border border-amber-500/20" id="exec-intent">Intent</span>
                        <span class="text-gray-600 text-[9px] md:text-[10px] font-bold uppercase tracking-widest">Engineering Case Study</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8">
                    <div class="exec-card p-6 md:p-8 rounded-2xl md:rounded-3xl">
                        <div class="flex items-center space-x-3 mb-4 text-gray-400">
                            <i data-lucide="alert-circle" class="w-4 h-4"></i>
                            <h4 class="text-[10px] font-black uppercase tracking-widest">The Problem</h4>
                        </div>
                        <p id="exec-problem" class="text-xs md:text-sm text-gray-300 leading-relaxed font-medium"></p>
                    </div>
                    <div class="exec-card p-6 md:p-8 rounded-2xl md:rounded-3xl">
                        <div class="flex items-center space-x-3 mb-4 text-amber-500">
                            <i data-lucide="cpu" class="w-4 h-4"></i>
                            <h4 class="text-[10px] font-black uppercase tracking-widest">The Solution</h4>
                        </div>
                        <p id="exec-solution" class="text-xs md:text-sm text-gray-300 leading-relaxed font-medium"></p>
                    </div>
                    <div class="exec-card p-6 md:p-8 rounded-2xl md:rounded-3xl">
                        <div class="flex items-center space-x-3 mb-4 text-green-500">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                            <h4 class="text-[10px] font-black uppercase tracking-widest">The Outcome</h4>
                        </div>
                        <p id="exec-result" class="text-xs md:text-sm text-gray-300 leading-relaxed font-medium"></p>
                    </div>
                </div>

                <div class="bg-gray-900/50 border border-white/5 p-6 md:p-10 rounded-2xl md:rounded-[3rem] relative overflow-hidden">
                    <h4 class="text-[9px] md:text-[11px] font-black text-amber-500 uppercase mb-8 md:mb-10 tracking-[0.2em] text-center">System Performance Metrics</h4>
                    <div id="exec-kpis" class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-12 relative z-10"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                    <div class="space-y-6">
                        <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="shield-alert" class="w-3 h-3"></i> Engineering Constraints
                        </h4>
                        <div id="exec-restraint" class="bg-black/20 p-6 md:p-8 rounded-2xl md:rounded-3xl border border-white/5 text-xs md:text-sm text-gray-400 italic leading-relaxed"></div>
                    </div>
                    <div class="space-y-6">
                        <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="target" class="w-3 h-3"></i> Functional Impact
                        </h4>
                        <div id="exec-value" class="bg-amber-500/5 p-6 md:p-8 rounded-2xl md:rounded-3xl border border-amber-500/10 text-xs md:text-sm text-amber-100/70 leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="drawer" class="fixed top-0 right-0 h-full w-full md:w-[520px] bg-[#0f172a] border-l border-white/10 shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-[60] flex flex-col">
            <div class="p-5 md:p-6 border-b border-white/5 flex justify-between items-center bg-gray-900/50">
                <div class="flex items-center space-x-4">
                    <div id="drawer-icon" class="p-3 bg-amber-500/20 rounded-xl text-amber-500 border border-amber-500/20"></div>
                    <div>
                        <h3 id="drawer-name" class="text-lg md:text-xl font-bold text-white">Node Name</h3>
                        <p id="drawer-type" class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Step Type</p>
                    </div>
                </div>
                <button onclick="closeDrawer()" class="p-2 hover:bg-white/5 rounded-full text-gray-400 transition-all">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="p-6 md:p-8 space-y-8 overflow-y-auto flex-grow console-scrollbar">
                <section class="bg-amber-500/5 border border-amber-500/20 p-5 rounded-2xl">
                    <h4 class="text-[10px] font-bold text-amber-500 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i data-lucide="lightbulb" class="w-3 h-3"></i> Conceptual metaphor
                    </h4>
                    <p id="drawer-metaphor" class="text-sm text-amber-100/90 leading-relaxed italic"></p>
                </section>

                <section>
                    <h4 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i data-lucide="target" class="w-3 h-3"></i> Engineering Goal
                    </h4>
                    <p id="drawer-purpose" class="text-sm text-gray-300 leading-relaxed font-medium"></p>
                </section>

                <section>
                    <h4 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 flex items-center gap-2">
                        <i data-lucide="terminal" class="w-3 h-3"></i> Logic Loop
                    </h4>
                    <div id="drawer-logic" class="bg-black/40 border border-white/5 rounded-xl p-5 text-xs text-gray-300 leading-relaxed mono whitespace-pre-wrap border-l-2 border-l-blue-500/50"></div>
                </section>

                <div class="bg-gray-900/50 p-5 rounded-2xl border border-white/5">
                    <h4 class="text-[10px] font-bold text-amber-500 uppercase mb-3">Toolchain</h4>
                    <div id="drawer-tools" class="flex flex-wrap gap-2"></div>
                </div>

                <section class="pb-10">
                    <h4 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Live execution</h4>
                    <div class="space-y-4">
                        <div class="bg-black/60 rounded-xl border border-blue-500/20 overflow-hidden">
                            <pre id="drawer-input" class="p-4 text-[10px] text-blue-300/80 overflow-x-auto mono"></pre>
                        </div>
                        <div class="bg-black/60 rounded-xl border border-purple-500/20 overflow-hidden">
                            <pre id="drawer-output" class="p-4 text-[10px] text-purple-300/80 overflow-x-auto mono"></pre>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <footer class="p-3 bg-gray-900 border-t border-gray-800 flex justify-center space-x-6 md:space-x-12 z-20 overflow-x-auto whitespace-nowrap scrollbar-hide">
            <div class="flex items-center space-x-2 text-[8px] font-black uppercase tracking-widest text-gray-600">
                <i data-lucide="database" class="w-3 h-3 text-amber-500/50"></i>
                <span>Truth vs Event</span>
            </div>
            <div class="flex items-center space-x-2 text-[8px] font-black uppercase tracking-widest text-gray-600">
                <i data-lucide="shield" class="w-3 h-3 text-amber-500/50"></i>
                <span>Deterministic Logic</span>
            </div>
            <div class="flex items-center space-x-2 text-[8px] font-black uppercase tracking-widest text-gray-600">
                <i data-lucide="award" class="w-3 h-3 text-amber-500/50"></i>
                <span>Java Certified</span>
            </div>
        </footer>
    </main>

    <script>
        const scenarioData = {
            'mother-ai': {
                title: "Mother AI Orchestrator",
                intent: "Recursive Cognitive Layer",
                summary: "A custom desktop IDE developed to enforce AI Context Persistence, solving context loss issues across long-running development sessions.",
                executive: {
                    problem: "Creative projects suffer from 'context drift' where technical vision is lost during multi-step build cycles.",
                    solution: "An IDE using dual-persistence (YAML/JSON) and recursive 'Echo' agents to synthesize event data into stable heuristics.",
                    result: "Achieved a 60% reduction in manual status tracking and preserved 90%+ context accuracy.",
                    value: "Transforms raw data into institutional knowledge; every lesson learned is automatically codified.",
                    kpis: [["Accuracy", "92%"], ["Overhead", "-60%"], ["Latency", "<2s"], ["State", "Prod"]],
                    restraint: "Automation is limited to metadata to preserve architectural integrity; manual confirmation required for code writes."
                },
                nodes: [
                    { id: 'm1', x: 100, y: 300, type: 'Input', name: 'Event Listener', icon: 'eye', purpose: 'Detects file changes via GitPython.', logic: 'Summarizes history to optimize context window for LLMs.', metaphor: 'A watchman at the gate writing in a notebook.', input: 'git_diff: app.py', output: 'Context: Summarized', tools: ['GitPython'] },
                    { id: 'm2', x: 400, y: 300, type: 'Core', name: 'Mother Core', icon: 'cpu', purpose: 'Central orchestrator IDE.', logic: 'Directs traffic and manages Tkinter frame transitions.', metaphor: 'The Librarian knowing where every book is.', input: 'Summarized Data', output: 'Action: Reflect', tools: ['Python', 'Tkinter'] },
                    { id: 'm3', x: 700, y: 300, type: 'Memory', name: 'Project Memory', icon: 'save', purpose: 'Local context storage.', logic: 'Stores session history in timestamped YAML logs.', metaphor: 'The project-specific notebook.', input: 'Reflection Data', output: 'Local State: Updated', tools: ['PyYAML'] },
                    { id: 'm4', x: 700, y: 100, type: 'Agent', name: 'Echo Engine', icon: 'message-circle', purpose: 'Meta-cognitive oversight.', logic: 'Recursive agent adjusts behavior based on accumulated insights.', metaphor: 'An assistant talking you through the plan.', input: 'Goal: Scale', output: 'Advice: Add Buffer', tools: ['Gemini 1.5'] },
                    { id: 'm5', x: 1000, y: 100, type: 'Gateway', name: 'Zapier Gateway', icon: 'zap', purpose: 'External sync.', logic: 'Syncs milestones to external CRM/Slack.', metaphor: 'The diplomat sending letters.', input: 'Event: Milestone', output: 'External: Success', tools: ['Zapier'] },
                    { id: 'm6', x: 1000, y: 300, type: 'Global', name: 'World Memory', icon: 'database', purpose: 'Global knowledge bank.', logic: 'Stabilizes insights across cross-project heuristics.', metaphor: 'The Master Encyclopedia.', input: 'Insight: API failure', output: 'Heuristic: Stable', tools: ['PostgreSQL'] }
                ],
                edges: [['m1', 'm2'], ['m2', 'm3'], ['m2', 'm4'], ['m4', 'm5'], ['m3', 'm6'], ['m5', 'm6']]
            },
            'zapier-debug': {
                title: "Failed Payment Debug",
                intent: "Financial Data Integrity",
                summary: "Fixes a critical 'Stale Data' bug in payment reminders by introducing runtime CRM lookups.",
                executive: {
                    problem: "Paid customers were receiving failure emails because automation relied on Stripe's stale initial triggers.",
                    solution: "Introduced a Step 11.5 forced CRM lookup to refresh source-of-truth before email dispatch.",
                    result: "100% elimination of erroneous emails. Restored brand trust.",
                    value: "Ensures communication always aligns with the live financial state.",
                    kpis: [["Error Rate", "0%"], ["Tickets", "-40%"], ["Precision", "100%"], ["Status", "Live"]],
                    restraint: "Fail-Closed: System halts if CRM API is unresponsive to prevent accidental sends."
                },
                nodes: [
                    { id: 'z1', x: 150, y: 300, type: 'Trigger', name: 'Stripe Alert', icon: 'zap', purpose: 'Capture signal.', logic: 'Captures charge ID; treated as untrusted signal.', metaphor: 'A snapshot of a moving train.', input: 'charge: failed', output: 'signal', tools: ['Stripe'] },
                    { id: 'z2', x: 450, y: 300, type: 'Buffer', name: '24h Delay', icon: 'clock', purpose: 'Allow self-correction.', logic: 'Essential friction to allow Stripe to retry charges.', metaphor: 'Waiting for a letter before replying.', input: 'signal', output: 'resumed', tools: ['Zapier'] },
                    { id: 'z3', x: 750, y: 300, type: 'Lookup', name: 'CRM Live Check', icon: 'search', purpose: 'Refresh truth.', logic: 'Querying live Deal Status (Step 11.5).', metaphor: 'Calling the owner to ask if they paid.', input: 'email: k@...', output: 'Status: Paid', tools: ['CRM API'] },
                    { id: 'z4', x: 1050, y: 300, type: 'Router', name: 'Halt Gate', icon: 'filter', purpose: 'Prevent misfire.', logic: 'If Status == Paid, kill the automation immediately.', metaphor: 'Checking the ticket before letting someone on.', input: 'Paid', output: 'HALT', tools: ['Filter'] },
                    { id: 'z5', x: 1350, y: 300, type: 'Action', name: 'Follow-up Email', icon: 'mail', purpose: 'Engagement.', logic: 'Sends email only if Filter passes.', metaphor: 'Delivering confirmed mail.', input: 'Unpaid', output: 'Email Sent', tools: ['Gmail API'] }
                ],
                edges: [['z1', 'z2'], ['z2', 'z3'], ['z3', 'z4'], ['z4', 'z5']]
            },
            'ai-validation': {
                title: "AI Validation Flow",
                intent: "Semantic Data Hygiene",
                summary: "A lead quality gate performing semantic validation to ensure only professional data enters the CRM.",
                executive: {
                    problem: "Unprotected webhooks resulting in 'Ghost Leads' that waste agent capacity.",
                    solution: "A semantic 'Air-Lock' gate performing an LLM professional focus check.",
                    result: "Zero spam records in CRM. 98% bot detection.",
                    value: "Guaranteed Data Integrity and high-intent focus for sales.",
                    kpis: [["Detection", "98%"], ["Hygiene", "100%"], ["Latency", "1.2s"], ["Status", "Live"]],
                    restraint: "Fallback: Leads diverted to isolation logs if AI is uncertain."
                },
                nodes: [
                    { id: 'v1', x: 100, y: 300, type: 'Trigger', name: 'Webhook Intake', icon: 'zap', purpose: 'Raw ingestion.', logic: 'Untrusted intake from public forms.', metaphor: 'Mailbox catching all letters.', input: 'raw_json', output: 'raw_lead', tools: ['Make'] },
                    { id: 'v2', x: 400, y: 300, type: 'AI Agent', name: 'Gemini Gatekeeper', icon: 'shield-check', purpose: 'Semantic check.', logic: 'Evaluates if text matches professional focus guidelines.', metaphor: 'Inspector reading for prohibited content.', input: 'junk text', output: 'fail_code', tools: ['Gemini'] },
                    { id: 'v3', x: 700, y: 300, type: 'Router', name: 'Decision Gate', icon: 'git-branch', purpose: 'Path selection.', logic: 'Routes based on AI-generated success codes.', metaphor: 'Traffic light for inspected cars.', input: 'fail_code', output: 'isolation', tools: ['Logic'] },
                    { id: 'v4', x: 1000, y: 100, type: 'Action', name: 'CRM Success', icon: 'database', purpose: 'Final storage.', logic: 'Maps enriched data to structured CRM fields.', metaphor: 'Placing approved item on shelf.', input: 'valid', output: 'lead_id', tools: ['Salesforce'] },
                    { id: 'v5', x: 1250, y: 100, type: 'Action', name: 'Slack Alert', icon: 'slack', purpose: 'Notification.', logic: 'Sends alert with lead context.', metaphor: 'Ringing the victory bell.', input: 'lead_id', output: 'Alert Sent', tools: ['Slack'] },
                    { id: 'v6', x: 1000, y: 450, type: 'Action', name: 'Fallback: Log', icon: 'alert-triangle', purpose: 'Safety.', logic: 'Logs raw input for manual audit.', metaphor: 'The Lost and Found box.', input: 'fail', output: 'logged', tools: ['PostgreSQL'] }
                ],
                edges: [['v1', 'v2'], ['v2', 'v3'], ['v3', 'v4'], ['v4', 'v5'], ['v3', 'v6']]
            },
            'attorney': {
                title: "Attorney Pipeline v2.0",
                intent: "Acquisition at Scale",
                summary: "A 28-step automation system to source, qualify, and generate personalized outreach for attorneys.",
                executive: {
                    problem: "Indiscriminate scraping lead to high API costs and low CRM hygiene.",
                    solution: "Staged data through GSheets for 5-layer Python deduplication and focus-grading.",
                    result: "96% lead accuracy and 50% cost reduction in scraping.",
                    value: "Scalable batch processing that only ingests high-intent leads.",
                    kpis: [["Accuracy", "96%"], ["Cost", "-50%"], ["Dedupe", "5-Layer"], ["Batch", "25"]],
                    restraint: "Manual Gate: Triggering is manual to ensure budget alignment."
                },
                nodes: [
                    { id: 'at1', x: 100, y: 300, type: 'Trigger', name: 'Manual Trigger', icon: 'zap', purpose: 'Cost control gate.', logic: 'Triggered upon territory verification.', metaphor: 'Opening the valve when ready.', input: 'START', output: 'START', tools: ['Notion'] },
                    { id: 'at2', x: 400, y: 300, type: 'Scraper', name: 'Relevance Scout', icon: 'search', purpose: 'Acquisition.', logic: 'Web acquisition of firm data.', metaphor: 'Scouting locations in a city.', input: 'params', output: 'raw_leads', tools: ['Relevance AI'] },
                    { id: 'at3', x: 700, y: 300, type: 'Buffer', name: 'Staging Buffer', icon: 'layers', purpose: 'Staging.', logic: 'Storage to prevent CRM API flooding.', metaphor: 'Holding area before inspection.', input: 'raw_leads', output: 'staged', tools: ['GSheets'] },
                    { id: 'at4', x: 1000, y: 300, type: 'Logic', name: '5-Layer Dedupe', icon: 'filter', purpose: 'Hygiene.', logic: 'Python check on Name, Email, Firm, Web, and Phone.', metaphor: 'Security guard checking five IDs.', input: 'staged', output: 'unique_lead', tools: ['Python'] },
                    { id: 'at5', x: 1300, y: 300, type: 'AI Agent', name: 'Focus Grader', icon: 'shield-check', purpose: 'Qualification.', logic: 'Grades leads HIGH/MED/LOW focus via Gemini.', metaphor: 'Specialist sorting mail.', input: 'unique_lead', output: 'focus: HIGH', tools: ['Gemini'] },
                    { id: 'at6', x: 1600, y: 300, type: 'Action', name: 'GPT Drafter', icon: 'pen-tool', purpose: 'Personalization.', logic: 'Drafts customized outreach.', metaphor: 'Ghostwriter drafting reply.', input: 'HIGH', output: 'Draft Created', tools: ['OpenAI'] }
                ],
                edges: [['at1', 'at2'], ['at2', 'at3'], ['at3', 'at4'], ['at4', 'at5'], ['at5', 'at6']]
            },
            'helpscout': {
                title: "Help Scout Sage",
                intent: "Efficiency Multiplier",
                summary: "Context-aware AI Co-pilot generating private internal drafts for agents using an Express service.",
                executive: {
                    problem: "Routine tickets consume 40% bandwidth, slowing resolutions.",
                    solution: "Developed an Express service using Help Scout API to inject drafts as internal notes.",
                    result: "60% reduction in response time and 80% cost reduction vs native tools.",
                    value: "Scaling support capacity via human-in-the-loop AI assistance.",
                    kpis: [["Costs", "-80%"], ["Adoption", "85%"], ["Drafting", "-60%"], ["Status", "Live"]],
                    restraint: "Draft-Only: AI acts strictly as ghostwriter for agent review."
                },
                nodes: [
                    { id: 'hs1', x: 100, y: 300, type: 'Trigger', name: 'Agent Call', icon: 'mouse-pointer-2', purpose: 'Agent activated.', logic: 'Sidebar app requests draft via Node.js Express.', metaphor: 'Raising hand for help.', input: 'thread_id', output: 'req', tools: ['Node.js', 'Express'] },
                    { id: 'hs2', x: 400, y: 300, type: 'Fetch', name: 'History Sync', icon: 'file-search', purpose: 'Fetch history.', logic: 'Retrieving all thread history via HS API.', metaphor: 'Assistant reading correspondence.', input: 'thread_id', output: 'history', tools: ['HS API'] },
                    { id: 'hs3', x: 700, y: 300, type: 'Intelligence', name: 'Intent Profiler', icon: 'brain-circuit', purpose: 'Categorization.', logic: 'Sentiment and intent analysis via Gemini 1.5.', metaphor: 'Reading the room.', input: 'msg: Refund?', output: 'intent: billing', tools: ['Gemini'] },
                    { id: 'hs4', x: 1000, y: 300, type: 'AI Agent', name: 'Sage Engine', icon: 'sparkles', purpose: 'Draft generation.', logic: 'Creates draft based on guidelines.', metaphor: 'Ghostwriter drafting response.', input: 'billing', output: 'draft_text', tools: ['Gemini'] },
                    { id: 'hs5', x: 1300, y: 300, type: 'Quality', name: 'Tone Polish', icon: 'check-check', purpose: 'Brand check.', logic: 'Tone and format optimization.', metaphor: 'Proofreader checking draft.', input: 'draft', output: 'final', tools: ['OpenAI'] },
                    { id: 'hs6', x: 1600, y: 300, type: 'Action', name: 'Note Injection', icon: 'send', purpose: 'Post note.', logic: 'Injects draft as private internal note.', metaphor: 'Placing sticky note on file.', input: 'final', output: 'SUCCESS', tools: ['HS API'] }
                ],
                edges: [['hs1', 'hs2'], ['hs2', 'hs3'], ['hs3', 'hs4'], ['hs4', 'hs5'], ['hs5', 'hs6']]
            },
            'aethelgard': {
                title: "Aethelgard RPG",
                intent: "Full-Stack Persistence",
                summary: "A complex, text-based Discord RPG demonstrating modular management with 30+ source files.",
                executive: {
                    problem: "Complex state management leads to database bloat and slow retrieval.",
                    solution: "Modular Python architecture with custom SQLite schema for player data.",
                    result: "Zero data loss with sub-millisecond query performance.",
                    value: "Manages complex state transitions and high-concurrency data events.",
                    kpis: [["Source", "30+ Files"], ["DB", "SQLite"], ["Language", "Python"], ["State", "Legacy"]],
                    restraint: "Strict decoupling of logic from data persistence."
                },
                nodes: [
                    { id: 'ae1', x: 100, y: 300, type: 'Trigger', name: 'Command Intake', icon: 'keyboard', purpose: 'User intake.', logic: 'Regex parsing of player intent and state checks.', metaphor: 'Referee listening to move.', input: '!attack', output: 'intent', tools: ['Python'] },
                    { id: 'ae2', x: 400, y: 300, type: 'Core', name: 'Battle Engine', icon: 'swords', purpose: 'Calculate logic.', logic: 'Determines outcomes across 30+ modular files.', metaphor: 'Rolling dice behind screen.', input: 'intent', output: 'results', tools: ['Python'] },
                    { id: 'ae3', x: 700, y: 300, type: 'DB', name: 'SQLite Storage', icon: 'database', purpose: 'Persistence.', logic: 'Transactional updates to player profiles.', metaphor: 'Writing on character sheet.', input: 'results', output: 'updated', tools: ['SQLite'] },
                    { id: 'ae4', x: 1000, y: 300, type: 'Broadcast', name: 'UI Feedback', icon: 'message-circle', purpose: 'Discord update.', logic: 'Returning feedback to Discord interface.', metaphor: 'Announcing result to crowd.', input: 'updated', output: 'msg', tools: ['discord.py'] }
                ],
                edges: [['ae1', 'ae2'], ['ae2', 'ae3'], ['ae3', 'ae4']]
            }
        };

        let currentActiveView = 'landing';
        let activeScenario = null;
        let isSimulating = false;
        let isTerminalActive = false;
        let isMobileMenuOpen = false;

        function toggleMobileMenu() {
            isMobileMenuOpen = !isMobileMenuOpen;
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (isMobileMenuOpen) {
                sidebar.classList.add('open');
                overlay.classList.remove('hidden-overlay');
                overlay.classList.add('visible');
            } else {
                sidebar.classList.remove('open');
                overlay.classList.remove('visible');
                overlay.classList.add('hidden-overlay');
            }
        }

        function setViewMode(mode) {
            currentActiveView = mode;
            document.getElementById('view-landing').classList.add('hidden');
            document.getElementById('view-architect').classList.add('hidden');
            document.getElementById('view-executive').classList.add('hidden');
            document.getElementById('main-header').classList.remove('hidden');

            if (mode === 'landing') {
                document.getElementById('view-landing').classList.remove('hidden');
                document.getElementById('main-header').classList.add('hidden');
            } else if (mode === 'architect') {
                document.getElementById('view-architect').classList.remove('hidden');
                renderCanvas();
            } else if (mode === 'executive') {
                document.getElementById('view-executive').classList.remove('hidden');
                renderExecutiveView();
            }

            document.querySelectorAll('.toggle-btn').forEach(b => {
                b.classList.remove('active');
                b.classList.add('text-gray-500');
            });
            const activeBtn = document.getElementById(`mode-${mode}`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.classList.remove('text-gray-500');
            }
        }

        function renderExecutiveView() {
            const s = scenarioData[activeScenario];
            if (!s) return;
            document.getElementById('exec-title').innerText = s.title;
            document.getElementById('exec-intent').innerText = s.intent;
            document.getElementById('exec-problem').innerText = s.executive.problem;
            document.getElementById('exec-solution').innerText = s.executive.solution;
            document.getElementById('exec-result').innerText = s.executive.result;
            document.getElementById('exec-restraint').innerText = s.executive.restraint;
            document.getElementById('exec-value').innerText = s.executive.value;
            
            const kpiContainer = document.getElementById('exec-kpis');
            kpiContainer.innerHTML = s.executive.kpis.map(k => `
                <div class="text-center group">
                    <div class="text-[8px] md:text-[9px] font-black text-gray-600 uppercase mb-1 md:mb-2 tracking-[0.2em] transition-colors">${k[0]}</div>
                    <div class="text-lg md:text-3xl font-black text-white group-hover:text-amber-500 transition-colors">${k[1]}</div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function addLog(message, type = 'info') {
            const container = document.getElementById('log-container');
            if (!container) return;
            const log = document.createElement('div');
            const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            if (type === 'success') log.className = "text-green-400";
            else if (type === 'process') log.className = "text-amber-400 font-bold";
            else if (type === 'system') log.className = "text-blue-400";
            else if (type === 'error') log.className = "text-red-400 font-bold";
            log.innerHTML = `<span class="opacity-20 mr-2 tracking-tighter">${time}</span> ${message}`;
            container.appendChild(log);
            container.scrollTop = container.scrollHeight;
        }

        function toggleTerminal(force) {
            const terminal = document.getElementById('live-terminal');
            const btn = document.getElementById('term-btn');
            if (force !== undefined) isTerminalActive = force;
            else isTerminalActive = !isTerminalActive;

            if (isTerminalActive) {
                terminal.style.opacity = '1'; 
                terminal.classList.remove('pointer-events-none', 'translate-y-10');
                if (btn) btn.classList.add('bg-amber-500/10', 'border-amber-500/50', 'text-amber-500');
            } else {
                terminal.style.opacity = '0'; 
                terminal.classList.add('pointer-events-none', 'translate-y-10');
                if (btn) btn.classList.remove('bg-amber-500/10', 'border-amber-500/50', 'text-amber-500');
            }
        }

        function loadScenario(id) {
            if (isSimulating) stopSimulation();
            const data = scenarioData[id];
            if (!data) return;
            activeScenario = id;
            if (isMobileMenuOpen) toggleMobileMenu();
            
            document.getElementById('scenario-title').innerText = data.title;
            document.querySelectorAll('nav button').forEach(btn => {
                btn.className = "w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-400 text-sm font-medium flex items-center justify-between transition-all group";
            });
            const activeBtn = document.getElementById(`btn-${id}`);
            if(activeBtn) activeBtn.className = "w-full text-left px-4 py-3 rounded-lg bg-amber-500/10 border border-amber-500/50 text-amber-500 text-sm font-bold flex items-center justify-between group";
            
            if (currentActiveView === 'landing') {
                setViewMode('architect');
            } else {
                setViewMode(currentActiveView);
            }
            
            addLog(`CONTEXT SWITCH: ${data.title}`, 'system');
        }

        function renderCanvas() {
            const data = scenarioData[activeScenario];
            if (!data) return;
            const nodeLayer = document.getElementById('node-layer');
            const svgLayer = document.getElementById('svg-layer');
            nodeLayer.innerHTML = ''; svgLayer.innerHTML = '';
            
            data.edges.forEach((edge, idx) => {
                const source = data.nodes.find(n => n.id === edge[0]);
                const target = data.nodes.find(n => n.id === edge[1]);
                if (!source || !target) return;
                const x1 = source.x + 192, y1 = source.y + 70, x2 = target.x, y2 = target.y + 70;
                const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
                line.setAttribute("d", `M ${x1} ${y1} C ${x1 + (x2-x1)/2} ${y1}, ${x1 + (x2-x1)/2} ${y2}, ${x2} ${y2}`);
                line.setAttribute("id", `path-${activeScenario}-${idx}`);
                line.setAttribute("stroke", "#1f2937"); line.setAttribute("stroke-width", "2");
                line.setAttribute("fill", "none"); line.setAttribute("class", "line-flow");
                svgLayer.appendChild(line);
            });
            
            data.nodes.forEach(node => {
                const div = document.createElement('div');
                div.id = `node-${node.id}`;
                div.className = "absolute node-card w-48 p-4 rounded-xl cursor-pointer shadow-xl z-10 flex flex-col h-[140px]";
                div.style.left = `${node.x}px`; div.style.top = `${node.y}px`;
                div.onclick = () => openDrawer(node);
                div.innerHTML = `<div class="glow-pulse"></div><span class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-2">${node.type}</span><div class="flex items-center space-x-3 mb-4"><div class="p-2 bg-gray-800 rounded-lg"><i data-lucide="${node.icon}" class="w-5 h-5"></i></div><h4 class="text-xs font-bold text-white leading-tight">${node.name}</h4></div>`;
                nodeLayer.appendChild(div);
            });
            lucide.createIcons();
        }

        async function startSimulation() {
            if (isSimulating || !activeScenario) return;
            isSimulating = true;
            toggleTerminal(true);
            const data = scenarioData[activeScenario];
            const svgLayer = document.getElementById('svg-layer');
            const packet = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            packet.setAttribute("r", "5"); packet.setAttribute("class", "data-packet");
            svgLayer.appendChild(packet);

            for (let i = 0; i < data.edges.length; i++) {
                if (!isSimulating) break;
                const edge = data.edges[i];
                const sourceNode = data.nodes.find(n => n.id === edge[0]);
                const path = document.getElementById(`path-${activeScenario}-${i}`);
                if (sourceNode) {
                    const nodeEl = document.getElementById(`node-${sourceNode.id}`);
                    if (nodeEl) {
                        nodeEl.classList.add('processing');
                        openDrawer(sourceNode);
                        addLog(`[STEP] ${sourceNode.name}`, 'process');
                    }
                    await new Promise(r => setTimeout(r, 600));
                    if (nodeEl) nodeEl.classList.remove('processing');
                }
                if (path) {
                    const length = path.getTotalLength();
                    const start = performance.now();
                    await new Promise(resolve => {
                        function animate(time) {
                            if (!isSimulating) return resolve();
                            const p = Math.min((time - start) / 600, 1);
                            const pt = path.getPointAtLength(p * length);
                            packet.setAttribute("cx", pt.x); packet.setAttribute("cy", pt.y);
                            if (p < 1) requestAnimationFrame(animate); else resolve();
                        }
                        requestAnimationFrame(animate);
                    });
                }
            }
            stopSimulation();
        }

        function stopSimulation() {
            isSimulating = false;
            document.querySelectorAll('.data-packet').forEach(p => p.remove());
            document.querySelectorAll('.node-card').forEach(n => n.classList.remove('processing', 'failed'));
            addLog(`TRACE COMPLETE.`, 'system');
        }

        function openDrawer(node, customInput = null) {
            const drawerEl = document.getElementById('drawer');
            if (!drawerEl) return;
            document.getElementById('drawer-name').innerText = node.name;
            document.getElementById('drawer-type').innerText = node.type;
            document.getElementById('drawer-logic').innerText = node.logic;
            document.getElementById('drawer-metaphor').innerText = node.metaphor;
            document.getElementById('drawer-purpose').innerText = node.purpose || "Primary engineering objective.";
            document.getElementById('drawer-input').innerText = customInput || node.input || "N/A";
            document.getElementById('drawer-output').innerText = node.output || "N/A";
            document.getElementById('drawer-tools').innerHTML = (node.tools || []).map(t => `<span class="px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400 font-bold border border-white/5 uppercase">${t}</span>`).join('');
            document.getElementById('drawer-icon').innerHTML = `<i data-lucide="${node.icon}" class="w-8 h-8"></i>`;
            drawerEl.classList.remove('translate-x-full'); 
            lucide.createIcons();
        }

        function closeDrawer() { document.getElementById('drawer').classList.add('translate-x-full'); }
        window.onload = () => { setViewMode('landing'); lucide.createIcons(); };
        document.getElementById('terminal-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const val = this.value.trim();
                if (!val) return;
                addLog(`INPUT: "${val}"`, 'process');
                startSimulation();
                this.value = '';
            }
        });
    </script>
</body>
</html>
